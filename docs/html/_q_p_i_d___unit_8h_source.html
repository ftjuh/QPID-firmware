<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QPIDfirmware: QPID_Unit.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cupid_64p.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QPIDfirmware
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   <div id="projectbrief">Object oriented firmware for autonomous motor drivers with encoder based PID controller and flexible interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_q_p_i_d___unit_8h_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QPID_Unit.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_q_p_i_d___unit_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#ifndef _QPID_Unit_h</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#define _QPID_Unit_h</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;ESP32Encoder.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;PID_v1.h&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___object_8h.html">QPID_Object.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___motor_driver_8h.html">QPID_MotorDriver.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___motor_driver___d_r_v8833_8h.html">QPID_MotorDriver_DRV8833.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___encoder_8h.html">QPID_Encoder.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___encoder___e_s_p32_8h.html">QPID_Encoder_ESP32.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___endstop_8h.html">QPID_Endstop.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_q_p_i_d___endstop___digital_8h.html">QPID_Endstop_Digital.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">/**************************************************************************/</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">// note: constructor needs default values for all params, else we can&#39;t define </span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">// an array of QPID_Units</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html">   47</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_q_p_i_d___unit.html">QPID_Unit</a> : <span class="keyword">public</span> <a class="code" href="class_q_p_i_d___object.html">QPID_Object</a> {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076">   96</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076">QPIDStates</a> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="comment">//disabled, ///&lt; ignore QPID, no counting, no PID, no motor changes</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a4f5f8a9edc96ab927e43817a126c06b3">   98</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a4f5f8a9edc96ab927e43817a126c06b3">runningToTarget</a>,      </div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a49b68bf63ca920ec1a2e89477a2ee4eb">   99</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a49b68bf63ca920ec1a2e89477a2ee4eb">targetReached</a>,        </div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a16f158acf096e86c36abab106903a903">  100</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a16f158acf096e86c36abab106903a903">constantSpeed</a>,        </div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5477963f71cd005822f97c48e916574b">  101</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5477963f71cd005822f97c48e916574b">constantSpeedUntil</a>,   </div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7b13dfbf10901dc4dacb855668470bda">  102</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7b13dfbf10901dc4dacb855668470bda">constantSpeedTo</a>,      </div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a242985d0ec20bf9ef8cebaacf9b78bfd">  103</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a242985d0ec20bf9ef8cebaacf9b78bfd">timeoutReached</a>,       </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7eae58e2350338f95361ae7d7ee0a2c2">  104</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7eae58e2350338f95361ae7d7ee0a2c2">stoppedByEndStop</a>,     </div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a3103a85901205f1a5e5f692a56da5b26">  105</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a3103a85901205f1a5e5f692a56da5b26">stoppedByPositionLimit</a>, </div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076afa4f973c940625b75a6a44e81bef7f14">  106</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076afa4f973c940625b75a6a44e81bef7f14">toEndStop</a>,            </div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076aa9e1f8b9834f492ff8cc5fe1afa110c5">  107</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076aa9e1f8b9834f492ff8cc5fe1afa110c5">endStopReached</a>,       </div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ab830197e590b8db02e9ad745c511fd64">  108</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ab830197e590b8db02e9ad745c511fd64">calibrating</a>,          </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ad97f32407e49f429c52c3e5b811263dd">  109</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ad97f32407e49f429c52c3e5b811263dd">off</a>,                  </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5a9858054aa5994cf936a65f0620e637">  110</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5a9858054aa5994cf936a65f0620e637">stopped</a>,              </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a454b0da016bdc607c3d4992d53be8094">  111</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a454b0da016bdc607c3d4992d53be8094">haltedOnError</a>,        </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    };</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">  115</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> {</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a7b94617328a73395daf3ac31b3b68990">  116</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a7b94617328a73395daf3ac31b3b68990">brake</a>,          </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a004244e4b26a4206e3a3b992dc3929d3">  117</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a004244e4b26a4206e3a3b992dc3929d3">coast</a>,          </div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a5ef2e183369f73456a4195ccfdb1124f">  118</a></span>&#160;      <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a5ef2e183369f73456a4195ccfdb1124f">PIDcontrolled</a>   </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    };</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="class_q_p_i_d___unit.html#a1634119eb34aa8ae30b730aa738eee3a">QPID_Unit</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_q_p_i_d___unit.html#af0103b90a43df7d0153494b13694090c">processMessage</a>(uint8_t *m) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#af7df449da99c44e18c75f57054c6bb6b">init</a>(<a class="code" href="class_q_p_i_d___motor_driver.html">QPID_MotorDriver</a>* d, <a class="code" href="class_q_p_i_d___encoder.html">QPID_Encoder</a>* e, <a class="code" href="class_q_p_i_d___endstop.html">QPID_Endstop</a>* es1, <a class="code" href="class_q_p_i_d___endstop.html">QPID_Endstop</a>* es2, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cycleInterval);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a816e55daefaebd6d4fbd16a4c10b9032">configureSpeedPID</a>(<span class="keywordtype">double</span> Kp, <span class="keywordtype">double</span> Ki, <span class="keywordtype">double</span> Kd, <span class="keywordtype">int</span> POn = P_ON_E);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a9e525da8a103938555042db78d20ca5a">configurePowerPID</a>(<span class="keywordtype">double</span> Kp, <span class="keywordtype">double</span> Ki, <span class="keywordtype">double</span> Kd, <span class="keywordtype">int</span> POn = P_ON_E);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a4236d08d0eac854b883aecac41a19f6b">configurePositionLimits</a>(<span class="keywordtype">double</span> min, <span class="keywordtype">double</span> max);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a62822c0086bd5c0cba47c23850d04869">configureSpeedLimits</a>(<span class="keywordtype">double</span> min, <span class="keywordtype">double</span> max);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a3add6e817c50b414d2973464f7651736">configurePowerLimits</a>(<span class="keywordtype">double</span> min, <span class="keywordtype">double</span> max);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#aa3906de3352775659e02f73184b1a07a">configureTolerances</a>(<span class="keywordtype">double</span> pos, <span class="keywordtype">double</span> speed);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a63fdc4e4df623265871fb62f99bc6990">runTo</a>(<span class="keywordtype">double</span> target);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#ab9cb82de6e7e69a834002948a1e66107">runDistance</a>(<span class="keywordtype">double</span> distance);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a60f0940dfad98d9e07e087f41e85add1">runAtSpeed</a>(<span class="keywordtype">double</span> speed);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a0bdc1b6fd295be57c9cb6ffccb981a83">runAtSpeedUntil</a>(<span class="keywordtype">double</span> speed, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> timeout, <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> mode);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#aaecbaf6967a11b84dbfc0fd957b0658f">runAtSpeedFor</a>(<span class="keywordtype">double</span> speed, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> duration, <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> mode);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">void</span> runAtSpeedTo(<span class="keywordtype">double</span> speed, <span class="keywordtype">double</span> target, <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> mode);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">void</span> runAtSpeedDistance(<span class="keywordtype">double</span> speed, <span class="keywordtype">double</span> distance, <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> mode);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#af7573a741c282636e0339410e9956f4a">calibrate</a>(<span class="keywordtype">bool</span> findEndstops, <span class="keywordtype">bool</span> findMaxSpeed, <span class="keywordtype">bool</span> findDeadbands, <span class="keywordtype">bool</span> findAccelerationCurve);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#aa64f023003ad54493aaaf5473f40f0da">setKick</a>(<span class="keywordtype">double</span> threshold, <span class="keywordtype">double</span> thresholdSpeed);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#a2c7c97636db19a4a9f36027f5b269ae6">disableKick</a>();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076">QPIDStates</a> <a class="code" href="class_q_p_i_d___unit.html#a928c69b8ab138c720d8fd33b6bfc29f8">getState</a>();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_q_p_i_d___unit.html#aadbecce3e6e4cd2203613241b83284e6">update</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">//private: //### disabled for testing</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">double</span> kicked(<span class="keywordtype">double</span> power);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_q_p_i_d___unit.html#a03a5aec75122e7534a3b06c107bb574e">outOfBounds</a>();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076">QPIDStates</a> state;    </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="class_q_p_i_d___motor_driver.html">QPID_MotorDriver</a>* driver;   <span class="comment">// each QPID_Unit has a motor driver</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="class_q_p_i_d___encoder.html">QPID_Encoder</a>* encoder;      <span class="comment">// each QPID_Unit has an encoder</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="class_q_p_i_d___endstop.html">QPID_Endstop</a>* endstop1;      <span class="comment">// each QPID_Unit has zero to two endstops</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="class_q_p_i_d___endstop.html">QPID_Endstop</a>* endstop2;          </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#a44c9a0f22100c049d6098da21b2f5d88">  159</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="class_q_p_i_d___unit.html#a44c9a0f22100c049d6098da21b2f5d88">kickThreshold</a>;       </div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_q_p_i_d___unit.html#ac2c20357a541493928841e990ad8c72c">  160</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="class_q_p_i_d___unit.html#ac2c20357a541493928841e990ad8c72c">kickThresholdSpeed</a>;  </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// state and state specific stuff</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nextCycle;    <span class="comment">// will be set according to cycleInterval</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nextStatistics; <span class="comment">//</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> nextDebugInfo; <span class="comment">//</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// states &quot;constant speed&quot;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> constantSpeedTimeout; <span class="comment">// millis() at which &#39;constantSpeed&#39; state will terminate, used by runAtSpeedUntil() and runAtSpeedFor()</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> constantSpeedTarget; <span class="comment">// position at which &#39;constantSpeed&#39; state will terminate, used by runAtSpeedTo() and runAtSpeedDistance()</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">stopMode</a> runAtSpeedStopMode;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// speed measurement and PID updates</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> cycleInterval; <span class="comment">// interval in microseconds for speed measurement and PID updates</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">double</span> lastPos; <span class="comment">// for speed measurement, position saved in previous cycle</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// PID stuff</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">double</span> currentPos, targetSpeed, targetPos, currentSpeed, outputPower; <span class="comment">// variables for both PIDs</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    PID* speedPID; <span class="comment">// PID for speed calculations, output &#39;targetSpeed&#39; will be input of powerPID</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">double</span> speedKp, speedKi, speedKd;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">double</span> minPos, maxPos;  <span class="comment">// limits for speedPID&#39;s targetPos</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">bool</span> usePositionLimits; <span class="comment">// flag to indicate if minPos and maxPos are to be used for target limiting</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    PID* powerPID; <span class="comment">// PID for PWM power calculations, output &#39;outputPower&#39; (PWM in most cases) will be input of motor driver</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">double</span> powerKp, powerKi, powerKd;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordtype">double</span> minSpeed, maxSpeed; <span class="comment">// limits for speedPID&#39;s targetSpeed; values are relative to cycleInterval!</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">double</span> minPower, maxPower; <span class="comment">// ~ limits for powerPID&#39;s outputPower, in most cases -255 to 255 for PWM</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// ~ motor and encoder specifics</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">//double maxRPM; // ~ maximum revolutions per minute of motor&#39;s (geared) output shaft</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">//double maxPulsesPerInterval; // ~ = (pulsesPerRound * maxRPM / (60*1000*1000) * cycleInterval;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// long motorTimeout; // ~ milliseconds of inactivity until motor will be switched to off state, -1 for never</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// error tolerances and filtering</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">double</span> posTolerance; <span class="comment">// max. distance between currentPos and targetPos considered as target reached</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">double</span> speedTolerance; <span class="comment">// max. speed at target needed to consider as target reached (= acceptable overshoot)</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// ~ statistics</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    uint16_t idleUpdatesCounter; <span class="comment">// number of calls to update() since last cycleInterval</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">double</span> maxPosStat, minPosStat;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">double</span> maxSpeedStat, minSpeedStat;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">double</span> maxPowerStat, minPowerStat;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;};</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">/***</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">  struct QPID_Unit {</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">  // pin definitions</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">  int8_t driverPin1, driverPin2;  // DRV8833 input pins, ### should be more flexible for other motors e.g. with EN pin by encapsulating this and motor control functions into a dedicated motor class</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">  int8_t encoderPin1, encoderPin2; // quad encoder input pins, -1 for non existant (in case of single pulse counters)</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">  encoderTypes encoderType; // 1=quad, 2=half, 3=single pulse, 4=analog input on encoderPin1  // ### the encoder, too, should be encapsulated into a dedicated class for more flexibility, e.g. allowing I2C angular hall sensors like AS5600</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">  int8_t endstop1Pin, endstop2Pin; // endstops, -1 for non existant (if endstop only at one end, or shared input for both endstops, or endless rotation w/o endstops)</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">  // member objects</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">  ESP32Encoder encoder; // ## make this generic for other types of RPTs</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">  Adafruit_DCMotor motor;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">  // PID stuff</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">  double currentPos, targetSpeed, targetPos, currentSpeed, outputPower; // variables for both PIDs</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">  PID *speedPID; // PID for speed calculations, output &#39;targetSpeed&#39; will be input of powerPID</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">  double speedKp, speedKi, speedKd;</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">  double minPos, maxPos;  // limits for speedPID&#39;s targetPos</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">  PID *powerPID; // PID for PWM power calculations, output &#39;outputPower&#39; (PWM in most cases) will be input of motor driver</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">  double powerKp, powerKi, powerKd;</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">  double minSpeed, maxSpeed; // limits for speedPID&#39;s targetSpeed; values are relative to cycleInterval!</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">  unsigned long cycleInterval; // interval in microseconds for speed measurement and PID updates</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">  // motor and encoder specifics</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">  double pulsesPerRound; // number of encoder steps generated for one turn of the motor&#39;s (geared) output shaft</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">  double maxRPM; // maximum revolutions per minute of motor&#39;s (geared) output shaft</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">  double maxPulsesPerInterval; // = (pulsesPerRound * maxRPM / (60*1000*1000) * cycleInterval;</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">  double kickThresholdSpeed; // max. speed considered as stopped motor, kickPower will be applied at slower speeds</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">  double kickPower; // minimum power (PWM) to get the motor going from stopped position</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">  double minPower, maxPower; // limits for powerPID&#39;s outputPower, in most cases -255 to 255 for PWM</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">  long motorTimeout; // milliseconds of inactivity until motor will be switched to off state, -1 for never</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">  // error tolerances and filtering</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  double posTolerance; // max. distance between currentPos and targetPos considered as target reached</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  double speedTolerance; // max. speed at target needed to consider as target reached (= acceptable overshoot)</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  unsigned long filter; // ### not implemented yet, meant to smooth out analog measurement errors</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  // state and state specific stuff</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  QPIDStates state; // current mode of operation</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">  unsigned long nextCycle;  // will be set according to cycleInterval</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">  unsigned long nextStatistics;</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">  unsigned long nextDebugInfo;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  //double lastPosition; // for speed measurement, position saved in previous cycle</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  // state &quot;constant speed&quot;</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  long constantSpeedEnding; // millis() at which &#39;constantSpeed&#39; state will switch to &#39;off&#39; state</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">  // statistics</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">  double maxPosStat, minPosStat;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">  double maxSpeedStat, minSpeedStat;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  double maxPowerStat, minPowerStat;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  };</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif // #ifndef _QPID_Unit_h</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_q_p_i_d___unit_html_ac2c20357a541493928841e990ad8c72c"><div class="ttname"><a href="class_q_p_i_d___unit.html#ac2c20357a541493928841e990ad8c72c">QPID_Unit::kickThresholdSpeed</a></div><div class="ttdeci">double kickThresholdSpeed</div><div class="ttdoc">Speeds lower than or equal to this value will be considered as stopped motor that needs a kick at low...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:160</div></div>
<div class="ttc" id="a_q_p_i_d___motor_driver___d_r_v8833_8h_html"><div class="ttname"><a href="_q_p_i_d___motor_driver___d_r_v8833_8h.html">QPID_MotorDriver_DRV8833.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a7b13dfbf10901dc4dacb855668470bda"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7b13dfbf10901dc4dacb855668470bda">QPID_Unit::constantSpeedTo</a></div><div class="ttdeci">@ constantSpeedTo</div><div class="ttdoc">running under PID control until constantSpeedTarget reached</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:102</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a8c6dd6dd1b2d41a5827c7715caaae881"><div class="ttname"><a href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881">QPID_Unit::stopMode</a></div><div class="ttdeci">stopMode</div><div class="ttdoc">Symbolic names for way to stop system in states with timeout.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:115</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ab9cb82de6e7e69a834002948a1e66107"><div class="ttname"><a href="class_q_p_i_d___unit.html#ab9cb82de6e7e69a834002948a1e66107">QPID_Unit::runDistance</a></div><div class="ttdeci">void runDistance(double distance)</div><div class="ttdoc">Make motor run a given distance.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:249</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_af0103b90a43df7d0153494b13694090c"><div class="ttname"><a href="class_q_p_i_d___unit.html#af0103b90a43df7d0153494b13694090c">QPID_Unit::processMessage</a></div><div class="ttdeci">bool processMessage(uint8_t *m) override</div><div class="ttdoc">Interprets messages specific for this class.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:591</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a49b68bf63ca920ec1a2e89477a2ee4eb"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a49b68bf63ca920ec1a2e89477a2ee4eb">QPID_Unit::targetReached</a></div><div class="ttdeci">@ targetReached</div><div class="ttdoc">motor stopped after target has been reached after runningToTarget</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:99</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076ab830197e590b8db02e9ad745c511fd64"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ab830197e590b8db02e9ad745c511fd64">QPID_Unit::calibrating</a></div><div class="ttdeci">@ calibrating</div><div class="ttdoc">determine position of endstops (maxPos/minPos), maxSpeed, deadbands, and acceleration curves</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:108</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a816e55daefaebd6d4fbd16a4c10b9032"><div class="ttname"><a href="class_q_p_i_d___unit.html#a816e55daefaebd6d4fbd16a4c10b9032">QPID_Unit::configureSpeedPID</a></div><div class="ttdeci">void configureSpeedPID(double Kp, double Ki, double Kd, int POn=P_ON_E)</div><div class="ttdoc">Set tuning parameters for speed PID.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:90</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a5a9858054aa5994cf936a65f0620e637"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5a9858054aa5994cf936a65f0620e637">QPID_Unit::stopped</a></div><div class="ttdeci">@ stopped</div><div class="ttdoc">motor enabled, but stopped by user</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:110</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a242985d0ec20bf9ef8cebaacf9b78bfd"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a242985d0ec20bf9ef8cebaacf9b78bfd">QPID_Unit::timeoutReached</a></div><div class="ttdeci">@ timeoutReached</div><div class="ttdoc">stopped after constantSpeedUntil</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:103</div></div>
<div class="ttc" id="a_q_p_i_d___object_8h_html"><div class="ttname"><a href="_q_p_i_d___object_8h.html">QPID_Object.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___encoder_html"><div class="ttname"><a href="class_q_p_i_d___encoder.html">QPID_Encoder</a></div><div class="ttdoc">Mostly abstract class for any kind of rotary encoder with optional filtering for jittery or error pro...</div><div class="ttdef"><b>Definition:</b> QPID_Encoder.h:39</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a1634119eb34aa8ae30b730aa738eee3a"><div class="ttname"><a href="class_q_p_i_d___unit.html#a1634119eb34aa8ae30b730aa738eee3a">QPID_Unit::QPID_Unit</a></div><div class="ttdeci">QPID_Unit()</div><div class="ttdoc">Constructor.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:33</div></div>
<div class="ttc" id="aclass_q_p_i_d___object_html"><div class="ttname"><a href="class_q_p_i_d___object.html">QPID_Object</a></div><div class="ttdoc">Base class for all QPID classes. Establishes interface for message processing and provides error repo...</div><div class="ttdef"><b>Definition:</b> QPID_Object.h:34</div></div>
<div class="ttc" id="a_q_p_i_d___encoder_8h_html"><div class="ttname"><a href="_q_p_i_d___encoder_8h.html">QPID_Encoder.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a44c9a0f22100c049d6098da21b2f5d88"><div class="ttname"><a href="class_q_p_i_d___unit.html#a44c9a0f22100c049d6098da21b2f5d88">QPID_Unit::kickThreshold</a></div><div class="ttdeci">double kickThreshold</div><div class="ttdoc">Minimum power to get the motor going from stopped position.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:159</div></div>
<div class="ttc" id="aclass_q_p_i_d___endstop_html"><div class="ttname"><a href="class_q_p_i_d___endstop.html">QPID_Endstop</a></div><div class="ttdoc">Abstract class for any kind of endstop switch.</div><div class="ttdef"><b>Definition:</b> QPID_Endstop.h:30</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a03a5aec75122e7534a3b06c107bb574e"><div class="ttname"><a href="class_q_p_i_d___unit.html#a03a5aec75122e7534a3b06c107bb574e">QPID_Unit::outOfBounds</a></div><div class="ttdeci">bool outOfBounds()</div><div class="ttdoc">Checks hardware endstops. Also checks virtual endstops, if enabled by setPositionLimits()....</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:380</div></div>
<div class="ttc" id="a_q_p_i_d___endstop___digital_8h_html"><div class="ttname"><a href="_q_p_i_d___endstop___digital_8h.html">QPID_Endstop_Digital.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_aa64f023003ad54493aaaf5473f40f0da"><div class="ttname"><a href="class_q_p_i_d___unit.html#aa64f023003ad54493aaaf5473f40f0da">QPID_Unit::setKick</a></div><div class="ttdeci">void setKick(double threshold, double thresholdSpeed)</div><div class="ttdoc">Due to inertia and friction, DC motors don't start to run at very low speeds, they need a &quot;kick&quot; to g...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:183</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a8c6dd6dd1b2d41a5827c7715caaae881a7b94617328a73395daf3ac31b3b68990"><div class="ttname"><a href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a7b94617328a73395daf3ac31b3b68990">QPID_Unit::brake</a></div><div class="ttdeci">@ brake</div><div class="ttdoc">will use QPID_MotorDriver::brake() after timout has been reached</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:116</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_af7df449da99c44e18c75f57054c6bb6b"><div class="ttname"><a href="class_q_p_i_d___unit.html#af7df449da99c44e18c75f57054c6bb6b">QPID_Unit::init</a></div><div class="ttdeci">void init(QPID_MotorDriver *d, QPID_Encoder *e, QPID_Endstop *es1, QPID_Endstop *es2, unsigned long cycleInterval)</div><div class="ttdoc">Attaches the neccessary and optional hardware. Motor driver and encoder are a must,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:65</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_aaecbaf6967a11b84dbfc0fd957b0658f"><div class="ttname"><a href="class_q_p_i_d___unit.html#aaecbaf6967a11b84dbfc0fd957b0658f">QPID_Unit::runAtSpeedFor</a></div><div class="ttdeci">void runAtSpeedFor(double speed, unsigned long duration, stopMode mode)</div><div class="ttdoc">Make motor run at constant speed for a given number of millis. Uses only power PID for control,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:321</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a63fdc4e4df623265871fb62f99bc6990"><div class="ttname"><a href="class_q_p_i_d___unit.html#a63fdc4e4df623265871fb62f99bc6990">QPID_Unit::runTo</a></div><div class="ttdeci">void runTo(double target)</div><div class="ttdoc">Make motor run to target position.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:223</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a8c6dd6dd1b2d41a5827c7715caaae881a004244e4b26a4206e3a3b992dc3929d3"><div class="ttname"><a href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a004244e4b26a4206e3a3b992dc3929d3">QPID_Unit::coast</a></div><div class="ttdeci">@ coast</div><div class="ttdoc">will use QPID_MotorDriver::coast() after timout has been reached</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:117</div></div>
<div class="ttc" id="aclass_q_p_i_d___motor_driver_html"><div class="ttname"><a href="class_q_p_i_d___motor_driver.html">QPID_MotorDriver</a></div><div class="ttdoc">Mostly abstract class that defines access methods and features for generic motors,...</div><div class="ttdef"><b>Definition:</b> QPID_MotorDriver.h:33</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a928c69b8ab138c720d8fd33b6bfc29f8"><div class="ttname"><a href="class_q_p_i_d___unit.html#a928c69b8ab138c720d8fd33b6bfc29f8">QPID_Unit::getState</a></div><div class="ttdeci">QPIDStates getState()</div><div class="ttdoc">Returns current state.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:207</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a9e525da8a103938555042db78d20ca5a"><div class="ttname"><a href="class_q_p_i_d___unit.html#a9e525da8a103938555042db78d20ca5a">QPID_Unit::configurePowerPID</a></div><div class="ttdeci">void configurePowerPID(double Kp, double Ki, double Kd, int POn=P_ON_E)</div><div class="ttdoc">Set tuning parameters for power PID.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:105</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a4236d08d0eac854b883aecac41a19f6b"><div class="ttname"><a href="class_q_p_i_d___unit.html#a4236d08d0eac854b883aecac41a19f6b">QPID_Unit::configurePositionLimits</a></div><div class="ttdeci">void configurePositionLimits(double min, double max)</div><div class="ttdoc">Set position limits and enable position checking if both values are different, disable if both are th...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:125</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a0bdc1b6fd295be57c9cb6ffccb981a83"><div class="ttname"><a href="class_q_p_i_d___unit.html#a0bdc1b6fd295be57c9cb6ffccb981a83">QPID_Unit::runAtSpeedUntil</a></div><div class="ttdeci">void runAtSpeedUntil(double speed, unsigned long timeout, stopMode mode)</div><div class="ttdoc">Make motor run at constant speed until given timeout is reached. Uses only power PID for control,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:296</div></div>
<div class="ttc" id="a_q_p_i_d___encoder___e_s_p32_8h_html"><div class="ttname"><a href="_q_p_i_d___encoder___e_s_p32_8h.html">QPID_Encoder_ESP32.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a62822c0086bd5c0cba47c23850d04869"><div class="ttname"><a href="class_q_p_i_d___unit.html#a62822c0086bd5c0cba47c23850d04869">QPID_Unit::configureSpeedLimits</a></div><div class="ttdeci">void configureSpeedLimits(double min, double max)</div><div class="ttdoc">Set speed limits. Will be used to limit the speedPID's output, which is fed into the powerPID.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:141</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a16f158acf096e86c36abab106903a903"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a16f158acf096e86c36abab106903a903">QPID_Unit::constantSpeed</a></div><div class="ttdeci">@ constantSpeed</div><div class="ttdoc">running endlessly under PID control</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:100</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076afa4f973c940625b75a6a44e81bef7f14"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076afa4f973c940625b75a6a44e81bef7f14">QPID_Unit::toEndStop</a></div><div class="ttdeci">@ toEndStop</div><div class="ttdoc">running at constant (slow) speed until hitting an endstop</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:106</div></div>
<div class="ttc" id="a_q_p_i_d___motor_driver_8h_html"><div class="ttname"><a href="_q_p_i_d___motor_driver_8h.html">QPID_MotorDriver.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a454b0da016bdc607c3d4992d53be8094"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a454b0da016bdc607c3d4992d53be8094">QPID_Unit::haltedOnError</a></div><div class="ttdeci">@ haltedOnError</div><div class="ttdoc">stopped by controller due to emergency event</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:111</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076">QPID_Unit::QPIDStates</a></div><div class="ttdeci">QPIDStates</div><div class="ttdoc">Symbolic names for QPID_Unit states that determine a QPID_Unit's behavior. The state machine depicted...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:96</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_af7573a741c282636e0339410e9956f4a"><div class="ttname"><a href="class_q_p_i_d___unit.html#af7573a741c282636e0339410e9956f4a">QPID_Unit::calibrate</a></div><div class="ttdeci">void calibrate(bool findEndstops, bool findMaxSpeed, bool findDeadbands, bool findAccelerationCurve)</div><div class="ttdoc">Do a test run to find system specific parameters.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:340</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a4f5f8a9edc96ab927e43817a126c06b3"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a4f5f8a9edc96ab927e43817a126c06b3">QPID_Unit::runningToTarget</a></div><div class="ttdeci">@ runningToTarget</div><div class="ttdoc">running under PID control, will stop and switch state to targetReached when target reached</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:98</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a7eae58e2350338f95361ae7d7ee0a2c2"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a7eae58e2350338f95361ae7d7ee0a2c2">QPID_Unit::stoppedByEndStop</a></div><div class="ttdeci">@ stoppedByEndStop</div><div class="ttdoc">stopped by QPID_MotorDriver::brake() after having met an endstop during any moving state different fr...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:104</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a2c7c97636db19a4a9f36027f5b269ae6"><div class="ttname"><a href="class_q_p_i_d___unit.html#a2c7c97636db19a4a9f36027f5b269ae6">QPID_Unit::disableKick</a></div><div class="ttdeci">void disableKick()</div><div class="ttdoc">Disables kicking.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:194</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a3103a85901205f1a5e5f692a56da5b26"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a3103a85901205f1a5e5f692a56da5b26">QPID_Unit::stoppedByPositionLimit</a></div><div class="ttdeci">@ stoppedByPositionLimit</div><div class="ttdoc">stopped by QPID_MotorDriver::brake() after running out of bounds set by setPositionLimits()</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:105</div></div>
<div class="ttc" id="a_q_p_i_d___endstop_8h_html"><div class="ttname"><a href="_q_p_i_d___endstop_8h.html">QPID_Endstop.h</a></div><div class="ttdoc">Part of the QPID autonomous motor driver project.</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_aadbecce3e6e4cd2203613241b83284e6"><div class="ttname"><a href="class_q_p_i_d___unit.html#aadbecce3e6e4cd2203613241b83284e6">QPID_Unit::update</a></div><div class="ttdeci">void update() override</div><div class="ttdoc">Main activity loop. Updates speed measurement, PIDs etc. Call this as often as possible,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:408</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a3add6e817c50b414d2973464f7651736"><div class="ttname"><a href="class_q_p_i_d___unit.html#a3add6e817c50b414d2973464f7651736">QPID_Unit::configurePowerLimits</a></div><div class="ttdeci">void configurePowerLimits(double min, double max)</div><div class="ttdoc">Set power limits. Will be used to limit the powerPID's output, which is fed into the motor driver.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:152</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_aa3906de3352775659e02f73184b1a07a"><div class="ttname"><a href="class_q_p_i_d___unit.html#aa3906de3352775659e02f73184b1a07a">QPID_Unit::configureTolerances</a></div><div class="ttdeci">void configureTolerances(double pos, double speed)</div><div class="ttdoc">Set tolerances used in runTo() to determine if a positional target has been reached.</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:164</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076a5477963f71cd005822f97c48e916574b"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076a5477963f71cd005822f97c48e916574b">QPID_Unit::constantSpeedUntil</a></div><div class="ttdeci">@ constantSpeedUntil</div><div class="ttdoc">running under PID control until constantSpeedTimeout</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:101</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a8c6dd6dd1b2d41a5827c7715caaae881a5ef2e183369f73456a4195ccfdb1124f"><div class="ttname"><a href="class_q_p_i_d___unit.html#a8c6dd6dd1b2d41a5827c7715caaae881a5ef2e183369f73456a4195ccfdb1124f">QPID_Unit::PIDcontrolled</a></div><div class="ttdeci">@ PIDcontrolled</div><div class="ttdoc">will set targetSpeed to 0 and use PID to slow down system</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:118</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076aa9e1f8b9834f492ff8cc5fe1afa110c5"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076aa9e1f8b9834f492ff8cc5fe1afa110c5">QPID_Unit::endStopReached</a></div><div class="ttdeci">@ endStopReached</div><div class="ttdoc">stopped by QPID_MotorDriver::brake() as expected after hitting an EndStop during ::toEndStop state</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:107</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html"><div class="ttname"><a href="class_q_p_i_d___unit.html">QPID_Unit</a></div><div class="ttdoc">A QPID_Unit objects bundles access to three hardware components, a motor driver, an position encoder,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:47</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_a60f0940dfad98d9e07e087f41e85add1"><div class="ttname"><a href="class_q_p_i_d___unit.html#a60f0940dfad98d9e07e087f41e85add1">QPID_Unit::runAtSpeed</a></div><div class="ttdeci">void runAtSpeed(double speed)</div><div class="ttdoc">Make motor run at constant speed until told otherwise. Uses only power PID for control,...</div><div class="ttdef"><b>Definition:</b> QPID_Unit.cpp:274</div></div>
<div class="ttc" id="aclass_q_p_i_d___unit_html_ada7b31c4261c3df9fe96f2d090341076ad97f32407e49f429c52c3e5b811263dd"><div class="ttname"><a href="class_q_p_i_d___unit.html#ada7b31c4261c3df9fe96f2d090341076ad97f32407e49f429c52c3e5b811263dd">QPID_Unit::off</a></div><div class="ttdeci">@ off</div><div class="ttdoc">motor disabled, stopped and released by user or by timeout</div><div class="ttdef"><b>Definition:</b> QPID_Unit.h:109</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_q_p_i_d___unit_8h.html">QPID_Unit.h</a></li>
    <li class="footer">Generated on Sun May 23 2021 20:20:20 for QPIDfirmware by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
